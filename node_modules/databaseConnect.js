var mysql=require('mysql');
// var EventEmitter = require('events').EventEmitter;
// exports.resultatRequete;
// //event
// var getData = new EventEmitter();
// getData.on('finish', function(result){
//     resultatRequete=result;
// });
const Config={host:'localhost',user:'root',password:'root',database:'mazoto'};
module.exports.Config=Config;
exports.getConnection=function(config){
   let con= mysql.createConnection(config);
    con.connect(function(error){
        if(error){
            throw error;
        }
        console.log('connected to the database');
    });
    return con;
}
exports.find=function(nomTable,afterWhere,con){
    let query="select * from "+nomTable;
    if(afterWhere!=null){
        query+=" where "+afterWhere;
    }
    return new Promise(function(resolve,reject){
        con.query(query,function(err,result){
            if(err){
               reject(err);
            }
            else{
                resolve(result);
                //con.end();
            }
        });
    });  
    //console.log(__dirname);
}
exports.insert=function(object,nomTable,con){
    let query=getSqlString(object,nomTable);
    return new Promise(function(resolve,reject){
        con.query(query,function(err){
            if(err){
               reject(err);
            }
            else{
                resolve("insert done");
                //con.end();
            }
        });
    }); 
}
function getSqlString(object,nomTable){
    let query="INSERT INTO "+nomTable;

    let nomAttr=" (";
    let value=" VALUES(";
    for(var name in object){
        nomAttr+=name+",";
        if(typeof object[name]=='string')value+="'"+object[name]+"',";
        else value+=object[name]+",";
    }
    nomAttr=nomAttr.slice(0,nomAttr.length-1);
    value=value.slice(0,value.length-1);
    nomAttr+=")";
    value+=")";
    query+=nomAttr+value;

    return query;
}